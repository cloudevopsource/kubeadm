
# 02.初始化master节点

<!-- TOC -->

- [01.安裝前的準備](#01.安裝前的準備)
    - [在每個節點安裝依賴工具](#在每個節點安裝依賴工具)
    - [安裝及準備ansible(在部署主機安裝ansible控制端)](#安裝及準備ansible(在部署主機安裝ansible控制端))

<!-- /TOC -->

## 创建kubeadm config配置文件 (第一个master节点)


``` bash
cd /stage
rm -f ./kubeadm-config.yaml
cat <<EOF > ./kubeadm-config.yaml
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v1.16.4
imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers
controlPlaneEndpoint: "127.0.0.1:8443"
networking:
  serviceSubnet: "10.96.0.0/16"
  podSubnet: "10.100.0.1/16"
  dnsDomain: "cluster.local"
EOF
```
## 初始化第一个master节点

``` bash
# kubeadm init
# 根据您服务器网速的情况，您需要等候 3 - 10 分钟
kubeadm init --config=kubeadm-config.yaml --upload-certs
```

## 安装 calico 网络插件
``` bash
# 参考文档 https://docs.projectcalico.org/v3.9/getting-started/kubernetes/
rm -f calico-3.9.2.yaml
wget https://kuboard.cn/install-script/calico/calico-3.9.2.yaml
sed -i "s#192\.168\.0\.0/16#10\.100\.0\.1/16#" calico-3.9.2.yaml
kubectl apply -f calico-3.9.2.yaml
```
